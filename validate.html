---
layout: default
---

<script src='assets/js/micca.js'></script>

<h3 class="section-title">About Validation</h3>
<div id='intro-section'>
  <p>
  The data validator runs locally in your web browser.  
  No data is transmitted to anywhere. 
  </p>
</div>

<h3 class="section-title">Data Validation</h3>
<div id='example-data'>
  Example data: <a href="assets/csv/good_data.csv">good_data.csv</a>, <a href="assets/csv/bad_data.csv">bad_data.csv</a>, <a href="assets/csv/good_data.xlsx">good_data.xlsx</a>, <a href="assets/csv/bad_header.csv">bad_header.csv</a>
</div>
<div id='getter-section'>
  <p>Step 1: Select MICCA input file.</p>
  <input id='input-file' type='file' onchange='onChangeHandler(this.files)'>
</div>

<div id='output-section'>
  <p>Step 2: Get report of issues with input data</p>
  <div id='validation-output'></div>

  <!-- Function to handle file input and display results -->
  <!-- Extract this to a bundle later -->
  <script> 
    function processData(rawText){
      let outsec = document.getElementById('validation-output');

      console.log("validation run");

      //Check validity and get list of problems
      let isValid = micca.Validator.validateFile(rawText);
      let problems = micca.Marple.reportProblems(rawText);

      outP = outsec.appendChild( document.createElement("p") );
      outP.innerHTML = "Processing Done";

      outVerdict = outsec.appendChild( document.createElement("p") );
      outP.innerHTML = `Input file is: ${isValid ? "Valid" : "Invalid"}`;

      if(!isValid){
        outP = outsec.appendChild( document.createElement("pre"));
        outP.innerHTML = JSON.stringify(problems, null, 2);
      }

      console.log("element added");
    }

    function onChangeHandler(files){
      console.log("file changed");
      // Clear existing outputs
      let outsec = document.getElementById('validation-output');
      while(outsec.firstChild){ outsec.removeChild(outsec.firstChild); }

      // Read file and update DOM
      let file = files[0];
      try{
        let reader = new FileReader();
        // Define what action to take upon loading input file
        reader.onload = function(e) { processData(reader.result); }
        // Do the read
        reader.readAsText(file);	
      }
      catch(err){ console.log(err); }
    }
  </script>
</div>
